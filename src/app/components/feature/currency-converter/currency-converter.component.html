<div class="converter-wrapper">
    <h1 class="title">Currency Converter</h1>
    @if(form && fromCurrencies().length) {
    <form [formGroup]="form" class="converter-form" (ngSubmit)="getRate()">

        <mat-form-field appearance="outline">
            <mat-label>Amount</mat-label>
            <input matInput formControlName="amount" type="number" />
            @if (form.get('amount')?.touched && form.get('amount')?.hasError('required')) {
            <mat-error>This field is required</mat-error>}
            @if (form.get('amount')?.touched && form.get('amount')?.hasError('min')) {
            <mat-error>Value must be greater than 0</mat-error>
            }
        </mat-form-field>

        <mat-form-field appearance="outline">
            <mat-label>From</mat-label>
            <mat-select formControlName="fromCurrency">
                @for(currency of fromCurrencies(); track currency){
                <mat-option [value]="currency.code">{{ currency.name }}</mat-option>
                }
            </mat-select>
            @if (form.get('fromCurrency')?.touched && form.get('fromCurrency')?.hasError('required')) {
            <mat-error>
                This field is required
            </mat-error>
            }
        </mat-form-field>

        <mat-form-field appearance="outline">
            <mat-label>To</mat-label>
            <mat-select formControlName="toCurrency">
                @for(currency of toCurrencies(); track currency){
                <mat-option [value]="currency.code">{{ currency.name }}</mat-option>
                }
            </mat-select>
            @if (form.get('toCurrency')?.touched && form.get('toCurrency')?.hasError('required')) {
            <mat-error>
                This field is required
            </mat-error>
            }
        </mat-form-field>
        <button mat-raised-button class="submit-button" type="submit" color="primary"
            [disabled]="form.invalid || isFetchingRate()">Go!</button>
    </form>

    @if (!isFetchingRate() && calculatedRate && !form.touched) {
    <h2>{{form.value.amount}} {{form.value.fromCurrency}} = {{ calculatedRate | number:'1.2-6' }}
        {{form.value.toCurrency}}</h2>
    } @else if (isFetchingRate()) {
    <h2>Fetching rate...</h2>
    <mat-progress-spinner mode="indeterminate" [diameter]="50"></mat-progress-spinner>
    } @else if (form.touched) {
    <h2>Asking for a new conversion...</h2>
    } @else {
    <h2>No request has been made yet</h2>
    }

    } @else {
    <h3>Loading currencies...</h3>
    <mat-progress-spinner mode="indeterminate" [diameter]="50"></mat-progress-spinner>
    }
    <button mat-raised-button class="chart-button" (click)="showChart()" [disabled]="!calculatedRate">Show Me The Rates
        from Past
        Week</button>

    <div class="chart-wrapper">
        <h2 class="chart-title">Rates history for the past week</h2>
        <div style="width: 700px;">
            <canvas baseChart type="line" [data]="chartData()" [options]="lineChartOptions">
            </canvas>
        </div>
    </div>

</div>